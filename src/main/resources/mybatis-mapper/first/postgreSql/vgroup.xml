<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bdp.ap.app.vgroup.mapper.VgroupMapper">

    <insert id="insertVgroup" parameterType="vgroupModel">
    	INSERT INTO T_VGROUP(
    		  GROUP_ID
    		, GROUP_NM
    		, GROUP_DSC
    		, USE_YN
    		, RGST_ID
			, RGST_DT
			, MODI_ID
			, MODI_DT
    	)VALUES(
    		#{groupId}
    		, #{groupNm}
    		, #{groupDsc}
    		, #{useYn}
    		, #{rgstId}
    		, NOW()
    		, #{modiId}
    		, NOW()
    	)
    </insert>

    <update id="updateVgroup" parameterType="vgroupModel">
    	UPDATE T_VGROUP
    	SET GROUP_NM = #{groupNm}
    		, GROUP_DSC = #{groupDsc}
    		, USE_YN = #{useYn}
    		, MODI_ID = #{modiId}
    		, MODI_DT = NOW()
    	WHERE GROUP_ID = #{groupId}	
    </update>

    <delete id="deleteVgroup" parameterType="vgroupModel">
 		UPDATE T_VGROUP
 		SET DEL_YN = 'Y'
 		WHERE GROUP_ID = #{groupId}
    </delete>
    
    <select id="selectVgroupList" parameterType="vgroupModel" resultType="vgroupModel">
    	SELECT
    		  GROUP_ID		AS GROUP_ID
    		, GROUP_NM		AS GROUP_NM
    		, GROUP_DSC		AS GROUP_DSC
    		, USE_YN		AS USE_YN
    		, DEL_YN		AS DEL_YN
    		, RGST_ID		AS RGST_ID
			, RGST_DT		AS RGST_DT
			, MODI_ID		AS MODI_ID
			, MODI_DT		AS MODI_DT
		FROM T_VGROUP
		<where>
			<if test="groupId != null and groupId != ''">
				AND GROUP_ID = #{groupId}
			</if>
			<if test="groupNm != null and groupNm != ''">
				AND UPPER(GROUP_NM) LIKE CONCAT('%',UPPER(#{groupNm}),'%')
			</if>
			<if test="groupDsc != null and groupDsc != ''">
				AND UPPER(GROUP_DSC) LIKE CONCAT('%',UPPER(#{groupDsc}),'%')
			</if>
			<if test="useYn != null and useYn != ''">
				AND USE_YN = #{useYn}
			</if>
			<if test="delYn != null and delYn != ''">
				AND DEL_YN = #{delYn}
			</if>
		</where>
		ORDER BY GROUP_NM
        <include refid="paging.pagingOffsetSQL" />	
    </select>

    <select id="selectVgroupListCount" parameterType="vgroupModel" resultType="int">
    	SELECT
    		 COUNT(1) AS cnt
		FROM T_VGROUP
		<where>
			<if test="groupId != null and groupId != ''">
				AND GROUP_ID = #{groupId}
			</if>
			<if test="groupNm != null and groupNm != ''">
				AND UPPER(GROUP_NM) LIKE CONCAT('%',UPPER(#{groupNm}),'%')
			</if>
			<if test="groupDsc != null and groupDsc != ''">
				AND UPPER(GROUP_DSC) LIKE CONCAT('%',UPPER(#{groupDsc}),'%')
			</if>
			<if test="useYn != null and useYn != ''">
				AND USE_YN = #{useYn}
			</if>
			<if test="delYn != null and delYn != ''">
				AND DEL_YN = #{delYn}
			</if>
		</where>
    </select>

    <select id="selectVgroup" parameterType="vgroupModel" resultType="vgroupModel">
    	SELECT
			  GROUP_ID		AS GROUP_ID
    		, GROUP_NM		AS GROUP_NM
    		, GROUP_DSC		AS GROUP_DSC
    		, USE_YN		AS USE_YN
    		, DEL_YN		AS DEL_YN
    		, RGST_ID		AS RGST_ID
			, RGST_DT		AS RGST_DT
			, MODI_ID		AS MODI_ID
			, MODI_DT		AS MODI_DT
		FROM T_VGROUP
		WHERE GROUP_ID = #{groupId}
    </select>

    <insert id="insertVgroupDtl" parameterType="vgroupModel">
		INSERT INTO T_VGROUP_DTL(
			  GROUP_ID
			, REF_TY
			, REF_ID
			, USE_YN
			, RGST_ID
			, RGST_DT
			, MODI_ID
			, MODI_DT
		)VALUES(
			  #{groupId}
			, #{refTy}
			, #{refId}
			, #{useYn}
			, #{rgstId}
    		, NOW()
    		, #{modiId}
    		, NOW()
		)
    </insert>

    <update id="updateVgroupDtl" parameterType="vgroupModel">
		UPDATE T_VGROUP_DTL
		SET   USE_YN = #{useYn}
			, MODI_ID = #{modiId}
    		, MODI_DT = NOW()
    	WHERE GROUP_ID = #{groupId}
    	AND REF_TY = #{refTy} 	
    	AND REF_ID = #{refId}
    </update>

    <delete id="deleteVgroupDtl" parameterType="vgroupModel">
    	UPDATE T_VGROUP_DTL
		SET USE_YN = 'N'
			, MODI_ID = #{modiId}
    		, MODI_DT = NOW()
    	WHERE GROUP_ID = #{groupId}
    	AND REF_TY = #{refTy}
    	AND REF_ID = #{refId}
    </delete>
    
    <select id="selectVgroupDtlList" parameterType="vgroupModel" resultType="vgroupModel">
		SELECT
			  GD.GROUP_ID		AS GROUP_ID
			, GD.REF_ID			AS REF_ID
			, GD.REF_TY			AS REF_TY
			, GD.USE_YN			AS USE_YN
			, GD.RGST_ID		AS RGST_ID
			, GD.RGST_DT		AS RGST_DT
			, GD.MODI_ID		AS MODI_ID
			, GD.MODI_DT		AS MODI_DT
			, U.USER_NM			AS USER_NM
		FROM T_VGROUP_DTL GD
		LEFT OUTER JOIN T_USER U
		ON GD.REF_ID = U.USER_ID
		<where>
			<if test="groupId != null and groupId != ''">
				AND GD.GROUP_ID = #{groupId}
			</if>
			<if test="userNm != null and userNm != ''">
				AND UPPER(U.USER_NM) LIKE CONCAT('%',UPPER(#{userNm}),'%')
			</if>
			<if test="useYn != null and useYn != ''">
				AND GD.USE_YN = #{useYn}
			</if>
		</where>
		ORDER BY U.USER_NM
		<include refid="paging.pagingOffsetSQL" />
    </select>

    <select id="selectVgroupDtlListCount" parameterType="vgroupModel" resultType="int">
		SELECT
			  COUNT(1) AS cnt
		FROM T_VGROUP_DTL GD
		LEFT OUTER JOIN T_USER U
		ON GD.REF_ID = U.USER_ID
		<where>
			<if test="groupId != null and groupId != ''">
				AND GD.GROUP_ID = #{groupId}
			</if>
			<if test="userNm != null and userNm != ''">
				AND UPPER(U.USER_NM) LIKE CONCAT('%',UPPER(#{userNm}),'%')
			</if>
			<if test="useYn != null and useYn != ''">
				AND GD.USE_YN = #{useYn}
			</if>
		</where>
    </select>

    <select id="selectVgroupDtl" parameterType="vgroupModel" resultType="vgroupModel">
    	SELECT
			  GD.GROUP_ID
			, GD.REF_ID
			, GD.REF_TY
			, GD.USE_YN
			, GD.RGST_ID
			, GD.RGST_DT
			, GD.MODI_ID
			, GD.MODI_DT
			, U.USER_NM
		FROM T_VGROUP_DTL GD
		LEFT OUTER JOIN T_USER U
		ON GD.REF_ID = U.USER_ID
		<where>
			<if test="groupId != null and groupId != ''">
				AND GD.GROUP_ID = #{groupId}
			</if>
			<if test="refTy != null and refTy != ''">
				AND GD.REF_TY = #{refTy}
			</if>
			<if test="refId != null and refId != ''">
				AND GD.REF_ID = #{refId}
			</if>
			<if test="useYn != null and useYn != ''">
				AND GD.USE_YN = #{useYn}
			</if>
		</where>
    </select>
</mapper>