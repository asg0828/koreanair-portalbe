<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bdp.ap.app.help.mapper.ScreenHelpMapper">
	<sql id="where">
		<where>
			<if test="searchValue != ''">
				<bind
						name="searchValue"
						value='@com.bdp.ap.common.EscapeHelper@escape(searchValue)'
				/>
			</if>
			<if test="searchKey != '' and searchKey == 'ALL' and searchValue != ''">
				AND (UPPER(sj) LIKE CONCAT('%',UPPER(#{searchValue}),'%') OR UPPER(cn) LIKE CONCAT('%',UPPER(#{searchValue}),'%'))
			</if>
			<if test="searchKey != '' and searchKey == 'sj' and searchValue != ''">
				AND UPPER(sj) LIKE CONCAT('%',UPPER(#{searchValue}),'%')
			</if>
			<if test="searchKey != '' and searchKey == 'cn' and searchValue != ''">
				AND UPPER(cn) LIKE CONCAT('%',UPPER(#{searchValue}),'%')
			</if>
			<if test="searchRegistYn != null and searchRegistYn != ''">
				AND REGIST_YN = #{searchRegistYn}
			</if>
			<if test="searchSystemCode != null and searchSystemCode != ''">
				AND SYSTEM_CD = #{searchSystemCode}
			</if>
			<if test="searchDeptCode != null and searchDeptCode != ''">
				AND MGR_DEPT_CD = #{searchDeptCode}
			</if>
		</where>
	</sql>
	
    <sql id="order">
        ORDER BY a.rownum ASC
    </sql> 	
 
	<select id="selectScreenHelpList" resultType="screenHelpModel" parameterType="com.bdp.ap.common.paging.Criteria">
		select
			*
		from (
			select
				row_number() over(order by tbn.rgst_dt desc) as rownum,
				tbn.screen_help_id,
				tbn.sj,
				tbn.cn,
				tbn.file_id,
				tbn.use_yn,
				tbn.rgst_id,
				tbn.rgst_dt,
				tbn.modi_id,
				tbn.modi_dt,
				tbn.view_cnt,
				tbn.system_cd,
				tbn.mgr_dept_cd,
				tbn.regist_yn,
				td.dept_nm	as mgr_dept_nm
			from
				ptl.t_screen_help tbn
				left join ptl.t_dept td on tbn.mgr_dept_cd = td.dept_code 
		) a
        <include refid="where" />
        <include refid="order" />
        <include refid="paging.pagingOffsetSQL" />  
    </select> 
 
	<select id="selectScreenHelpListCount" resultType="int" parameterType="com.bdp.ap.common.paging.Criteria">
		SELECT
			COUNT(*)
		FROM 
			ptl.t_screen_help
		<include refid="where" />
	</select>

	<select id="selectScreenHelp" resultType="screenHelpModel" parameterType="screenHelpModel">
		select *
		from
				ptl.t_screen_help tbn
		where
			tbn.screen_help_id = #{screenHelpId}

	</select>
	
	<insert id="insertScreenHelp" parameterType="screenHelpModel">
		INSERT INTO ptl.t_screen_help (
			screen_help_id,
			sj,
			cn,
			file_id,
			regist_yn,
			rgst_id,
			rgst_dt,
			modi_id,
			modi_dt,
			view_cnt,
			system_cd,
			mgr_dept_cd,
			input_attr,
			out_attr
		) VALUES (
			#{screenHelpId},
			#{sj},
			#{cn},
			#{fileId},
			#{registYn},
			#{rgstId},
			now(),
			#{modiId},
			now(),
			0,
			#{systemCd},
			#{mgrDeptCd},
			#{inputAttr},
			#{outAttr}
		)
	</insert>
	
	<update id="updateScreenHelp" parameterType="screenHelpModel">
		UPDATE
			ptl.t_screen_help
		SET
			sj = #{sj},
			cn = #{cn},
			file_id = #{fileId},
			regist_yn = #{registYn},
			modi_id = #{modiId},
			modi_dt = now(),
			system_cd = #{systemCd},
			mgr_dept_cd = #{mgrDeptCd}
	   WHERE
			screen_help_id = #{screenHelpId}
	</update>
	
	<update id="deleteScreenHelp" parameterType="screenHelpModel">
		UPDATE
			ptl.t_screen_help
		set
			use_yn = 'N',
			modi_id = #{modiId},
			modi_dt = now()
		WHERE
			screen_help_id = #{screenHelpId}
	</update>
	
</mapper>