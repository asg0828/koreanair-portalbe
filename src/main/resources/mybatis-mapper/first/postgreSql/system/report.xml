<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bdp.ap.app.system.mapper.ReportMapper">

	<select id="selectReportListType" resultType="reportModel" parameterType="reportModel">
	    SELECT 
	          TR.REPORT_ID				AS REPORT_ID
	        , TR.VER					AS VER
	        , TR.REPORT_NM				AS REPORT_NM
	        , TR.REPORT_TY				AS REPORT_TY
	        , (SELECT CODE_NM FROM T_CODE WHERE GROUP_ID = 'RPT_TY' AND CODE_ID = TR.REPORT_TY) AS REPORT_TY_NM
	        , TR.REPORT_DSC				AS REPORT_DSC
	        , TR.REPORT_URL				AS REPORT_URL
	        , TR.REPORT_ATTR			AS REPORT_ATTR
	        , TR.PREVIEW_URL			AS PREVIEW_URL
	        , TR.TABLEAU_WORKBOOK_ID	AS TABLEAU_WORKBOOK_ID
	        , TR.FILE_ID				AS FILE_ID
	        , TR.PCPT_INFO				AS PCPT_INFO
	        , TR.EXECUT_CYCLE			AS EXECUT_CYCLE
	        , TR.ORD_SEQ				AS ORD_SEQ
	        , TR.VIEW_CNT				AS VIEW_CNT
	        , TR.MAIN_PICR_ID			AS MAIN_PICR_ID
	        , (SELECT USER_NM FROM T_USER WHERE USER_ID = TR.MAIN_PICR_ID) AS MAIN_PICR_NM
	        , (SELECT DEPT_NM FROM T_DEPT WHERE DEPT_CODE = (SELECT DEPT_CODE FROM T_USER WHERE USER_ID = TR.MAIN_PICR_ID)) AS MAIN_PICR_DEPT	
	        , TR.SUB_PICR_ID			AS SUB_PICR_ID
	        , (SELECT USER_NM FROM T_USER WHERE USER_ID = TR.SUB_PICR_ID) AS SUB_PICR_NM
	        , (SELECT DEPT_NM FROM T_DEPT WHERE DEPT_CODE = (SELECT DEPT_CODE FROM T_USER WHERE USER_ID = TR.SUB_PICR_ID)) AS SUB_PICR_DEPT
	        , TR.USE_YN					AS USE_YN
	        , TR.RGST_ID				AS RGST_ID
	        , TR.RGST_DT				AS RGST_DT
	        , TR.MODI_ID				AS MODI_ID
	        , TR.MODI_DT				AS MODI_DT
	    FROM 
	          T_REPORT TR
	    <where>
	        <if test="searchValue != null and searchValue != ''">
				<bind
						name="searchValue"
						value='@com.bdp.ap.common.EscapeHelper@escape(searchValue)'
				/>
	            AND UPPER(TR.REPORT_NM) LIKE CONCAT('%',UPPER(#{searchValue}),'%')	
	        </if>
	        <if test="reportTy != null and reportTy != ''">
	            AND TR.REPORT_TY = #{reportTy}
	        </if>
		</where>
		ORDER BY TR.RGST_DT DESC
		<if test="pageSize != null and pageSize > 0">
	    	<include refid="paging.pagingOffsetSQL" />
	    </if>
	</select>
	
	<select id="selectReportListTypeCount" resultType="int" parameterType="reportModel">
		SELECT 
			COUNT(1)
		FROM
			T_REPORT TR
		<where>

	        <if test="searchValue != null and searchValue != ''">
				<bind
						name="searchValue"
						value='@com.bdp.ap.common.EscapeHelper@escape(searchValue)'
				/>
	            AND UPPER(TR.REPORT_NM) LIKE CONCAT('%',UPPER(#{searchValue}),'%')	
	        </if>
	        <if test="reportTy != null and reportTy != ''">
	            AND TR.REPORT_TY = #{reportTy}
	        </if>
		</where>
	</select>
	
	<select id="selectReport" resultType="reportModel" parameterType="reportModel">
	    SELECT 
	          TR.REPORT_ID				AS REPORT_ID
	        , TR.VER					AS VER
	        , TR.REPORT_NM				AS REPORT_NM
	        , TR.REPORT_TY				AS REPORT_TY
	        , (SELECT CODE_NM FROM T_CODE WHERE GROUP_ID = 'RPT_TY' AND CODE_ID = TR.REPORT_TY) AS REPORT_TY_NM
	        , TR.REPORT_DSC				AS REPORT_DSC
	        , TR.REPORT_URL				AS REPORT_URL
	        , TR.REPORT_ATTR			AS REPORT_ATTR
	        , TR.PREVIEW_URL			AS PREVIEW_URL
	        , TR.TABLEAU_WORKBOOK_ID	AS TABLEAU_WORKBOOK_ID
	        , TR.FILE_ID				AS FILE_ID
	        , TR.PCPT_INFO				AS PCPT_INFO
	        , TR.EXECUT_CYCLE			AS EXECUT_CYCLE
	        , TR.ORD_SEQ				AS ORD_SEQ
	        , TR.VIEW_CNT				AS VIEW_CNT
	        , TR.MAIN_PICR_ID			AS MAIN_PICR_ID
	        , (SELECT USER_NM FROM T_USER WHERE USER_ID = TR.MAIN_PICR_ID) AS MAIN_PICR_NM
	        , (SELECT DEPT_NM FROM T_DEPT WHERE DEPT_CODE = (SELECT DEPT_CODE FROM T_USER WHERE USER_ID = TR.MAIN_PICR_ID)) AS MAIN_PICR_DEPT	
	        , TR.SUB_PICR_ID			AS SUB_PICR_ID
	        , (SELECT USER_NM FROM T_USER WHERE USER_ID = TR.SUB_PICR_ID) AS SUB_PICR_NM
	        , (SELECT DEPT_NM FROM T_DEPT WHERE DEPT_CODE = (SELECT DEPT_CODE FROM T_USER WHERE USER_ID = TR.SUB_PICR_ID)) AS SUB_PICR_DEPT
	        , TR.USE_YN					AS USE_YN
	        , TR.RGST_ID				AS RGST_ID
	        , TR.RGST_DT				AS RGST_DT
	        , TR.MODI_ID				AS MODI_ID
	        , TR.MODI_DT				AS MODI_DT
	    FROM 
	        T_REPORT TR
	    WHERE
	        TR.REPORT_ID = #{reportId}
	</select>

</mapper>