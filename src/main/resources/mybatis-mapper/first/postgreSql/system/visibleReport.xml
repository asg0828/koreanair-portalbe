<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bdp.ap.app.system.mapper.VisibleReportMapper">
	<sql id="where">
		<where>
			<if test="searchValue != '' and searchValue != ''">
				AND UPPER(visible_report_nm) LIKE CONCAT('%',UPPER(#{searchValue}),'%')
			</if>
			<if test="activeYn != null and activeYn != ''">
				AND active_yn = #{activeYn}
			</if>
		</where>
	</sql>
	
	<select id="selectVisibleReportList" resultType="visibleReportModel" parameterType="com.bdp.ap.common.paging.Criteria">
			select
				row_number() over(order by v.visible_report_id desc) as rownum,
				v.visible_report_id,
				v.visible_report_nm,
				v.visible_report_dsc,
				v.active_yn,
				(case
					when active_yn = 'N' then '비활성'
					when active_yn = 'Y' then '활성'
					else ''
				end) as active_nm,
				v.rgst_id,
				v.rgst_dt,
				v.modi_id,
				v.modi_dt
			from
				ptl.t_visible_report v
        <include refid="where" />
        <include refid="paging.pagingOffsetSQL" />  
    </select> 
 
	<select id="selectVisibleReportListCount" resultType="int" parameterType="com.bdp.ap.common.paging.Criteria">
		SELECT
			COUNT(*)
		FROM 
			ptl.t_visible_report
		<include refid="where" />
	</select>

	<insert id="insertVisibleReport" parameterType="visibleReportModel">
		insert into ptl.t_visible_report(
			visible_report_id,
			visible_report_nm,
			visible_report_dsc,
			active_yn,
			rgst_id,
			rgst_dt,
			modi_id,
			modi_dt
		)
		values(
			#{visibleReportId},
			#{visibleReportNm},
			#{visibleReportDsc},
			#{activeYn},
			#{rgstId},
			now(),
			#{modiId},
			now()
		)
	</insert>

	<select id="selectVisibleReport" parameterType="visibleReportModel" resultType="visibleReportModel">
		select *
		from ptl.t_visible_report
		where visible_report_id = #{visibleReportId}
	</select>

	<update id="updateVisibleReport" parameterType="visibleReportModel">
		update ptl.t_visible_report set
			visible_report_nm = #{visibleReportNm},
			visible_report_dsc = #{visibleReportDsc},
			active_yn = #{activeYn},
			modi_id = #{modiId},
			modi_dt = now()
		where visible_report_id = #{visibleReportId}	
	</update>

	
</mapper>