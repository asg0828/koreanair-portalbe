<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bdp.ap.app.board.mapper.FaqMapper">
	<sql id="where">
		<where>
			<if test="searchValue != '' ">
				<bind
						name="searchValue"
						value='@com.bdp.ap.common.EscapeHelper@escape(searchValue)'
				/>
			</if>
			<if test="searchKey != '' and searchKey == 'ALL' and searchValue != ''">
				AND (UPPER(qstn) LIKE CONCAT('%',UPPER(#{searchValue}),'%') OR UPPER(answ) LIKE CONCAT('%',UPPER(#{searchValue}),'%'))
			</if>
			<if test="searchKey != '' and searchKey == 'QSTN' and searchValue != ''">
				AND UPPER(qstn) LIKE CONCAT('%',UPPER(#{searchValue}),'%')
			</if>
			<if test="searchKey != '' and searchKey == 'ANSW' and searchValue != ''">
				AND UPPER(answ) LIKE CONCAT('%',UPPER(#{searchValue}),'%')
			</if>
			<if test="searchUseYn != null and searchUseYn != ''">
				AND USE_YN = #{searchUseYn}
			</if>
			AND DEL_YN = 'N'				
		</where>
	</sql>

	<sql id="order">
		ORDER BY modi_Dt desc, cl_code ASC, qstn ASC
	</sql> 
 
	<select id="selectFaqList" parameterType="criteria" resultType="faqModel">
		SELECT
			*
		FROM (
			SELECT
				faq.faq_id,
				faq.cl_code,
				(SELECT CODE_NM FROM T_CODE WHERE GROUP_ID = 'FAQ_CAT' AND CODE_ID = faq.cl_code) AS faq_cate_nm,
				faq.qstn,
				faq.answ,
				faq.ord_seq,
				faq.use_yn,
				faq.del_yn,
				faq.rgst_id,
				faq.rgst_dt,
				faq.modi_id,
				faq.modi_dt,
				faq.view_cnt,
				tu.user_nm 		AS RGST_NM
			FROM 
				ptl.t_bbs_faq faq
			LEFT OUTER JOIN T_USER tu ON faq.RGST_ID = tu.user_id
		) A
		<include refid="where" />
		<include refid="order" />
		<include refid="paging.pagingOffsetSQL" />			
	</select>

	<select id="selectFaqListCount" parameterType="criteria" resultType="int">
		select
			count(1)
		from
			ptl.t_bbs_faq faq
		<include refid="where" />
	</select>

	<select id="selectFaq" parameterType="faqModel" resultType="faqModel">
		SELECT
			faq.faq_id,
			faq.cl_code,
			(SELECT CODE_NM FROM T_CODE WHERE GROUP_ID = 'FAQ_CAT' AND CODE_ID = faq.cl_code) AS faq_cate_nm,
			faq.qstn,
			faq.answ,
			faq.ord_seq,
			faq.use_yn,
			faq.del_yn,
			faq.rgst_id,
			faq.rgst_dt,
			faq.modi_id,
			faq.modi_dt,
			faq.view_cnt
		FROM 
			ptl.t_bbs_faq faq
		WHERE
			faq.faq_id = #{faqId}
			AND faq.del_yn = 'N'		
	</select>
	
	<insert id="insertFaq" parameterType="faqModel">
		INSERT INTO ptl.t_bbs_faq (
			faq_id,
			cl_code,
			qstn,
			answ,
			ord_seq,
			use_yn,
			del_yn,
			rgst_id,
			rgst_dt,
			modi_id,
			modi_dt,
			view_cnt
		) VALUES (
			#{faqId},
			#{clCode},
			#{qstn},
			#{answ},
			#{ordSeq},
			#{useYn},
			'N',
			#{rgstId},
			now(),
			#{modiId},
			now(),
			0
		)
	</insert>
	
	<update id="updateFaq" parameterType="faqModel">
		UPDATE
			ptl.t_bbs_faq
		SET
			cl_code = #{clCode}
		  , qstn = #{qstn}
		  , answ = #{answ}
		  , ord_seq = #{ordSeq}
		  , use_yn = #{useYn}
		  , modi_dt = now()
		  , modi_id = #{modiId}
	   WHERE
			faq_id = #{faqId}
	</update>
	
	<update id="deleteFaq" parameterType="faqModel">
		UPDATE
			ptl.t_bbs_faq
		SET
		    del_yn = 'Y'
		  , modi_dt = now()
		  , modi_id = #{modiId}
	   WHERE
			faq_id = #{faqId}
	</update>	
	

</mapper>